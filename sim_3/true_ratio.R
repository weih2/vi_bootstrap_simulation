## compute true ratio through Monte Carlo simulation


true.ratio.mc = function(n.samples = 10^6){ # default one million samples
  N <<- n.samples
  gen.new.data()
  
  # compute latent posterior at true global parameter
  latent.posterior = apply(exp(-outer(x, mu0, "-")^2/2), 1, function(prob){
    prob/sum(prob)
  })
  
  # estimate Fisher info
  score.est = latent.posterior * outer(mu0, x, "-")
  diag.Fisher.info.est = apply( score.est ^2 , 1, mean)
  
  # estimate latent info
  diag.latent.info.est = apply(
      (latent.posterior -
      latent.posterior^2) *
      (outer(mu0, x, "-")^2),
    1, mean)
  
  # true ratio
  (diag.Fisher.info.est + diag.latent.info.est)/diag.Fisher.info.est
}

sapply( rep(10^7, 5), true.ratio.mc)

true.ratios = matrix(nrow = 0, ncol = 3)
for(delta in test.seq){
  mu0 <<- c(-delta, 0, delta)
  true.ratios = rbind(true.ratios, true.ratio.mc())
}

true.ratios
[,1]     [,2]     [,3]
[1,] 2.989872 3.004952 2.990394
[2,] 2.987133 3.006036 2.988863
[3,] 2.985701 3.007337 2.985244
[4,] 2.982088 3.008986 2.982291
[5,] 2.977840 3.011047 2.978203
[6,] 2.973977 3.013378 2.973195
[7,] 2.969352 3.016338 2.966254
[8,] 2.961710 3.019913 2.960076
[9,] 2.954006 3.024113 2.952110
[10,] 2.939862 3.029485 2.945582
[11,] 2.931386 3.035994 2.929297
[12,] 2.918685 3.043851 2.912659
[13,] 2.896484 3.053374 2.899738
[14,] 2.877613 3.064555 2.879065
[15,] 2.855674 3.078147 2.853699
[16,] 2.825177 3.095115 2.824793
[17,] 2.792214 3.114741 2.793427
[18,] 2.753980 3.139182 2.751731
[19,] 2.709600 3.166801 2.713041
[20,] 2.664762 3.199391 2.664875
[21,] 2.607929 3.239269 2.609201
[22,] 2.549700 3.285305 2.548080
[23,] 2.486003 3.337980 2.485365
[24,] 2.409148 3.398875 2.423056
[25,] 2.346430 3.465370 2.354582
[26,] 2.276493 3.542506 2.273808
[27,] 2.202501 3.622469 2.209570
[28,] 2.132975 3.710804 2.134423
[29,] 2.063640 3.799469 2.057418
[30,] 1.992588 3.885179 1.992961
[31,] 1.933270 3.960636 1.927318
[32,] 1.864300 4.023489 1.862290
[33,] 1.810151 4.048200 1.806074
[34,] 1.754988 4.035018 1.754889
[35,] 1.703488 3.974000 1.700514
[36,] 1.653396 3.848879 1.655431
[37,] 1.609293 3.655995 1.610911
[38,] 1.566368 3.407218 1.568075
[39,] 1.522713 3.101900 1.523106
[40,] 1.470064 2.770642 1.474235
[41,] 1.419296 2.436924 1.416454
[42,] 1.358874 2.112729 1.357827
[43,] 1.291899 1.828403 1.294252
[44,] 1.228834 1.588685 1.227271
[45,] 1.165757 1.396873 1.165293
[46,] 1.111489 1.252282 1.111984
[47,] 1.068948 1.148543 1.069314
[48,] 1.037771 1.079519 1.038261
[49,] 1.017904 1.036676 1.017935
[50,] 1.007594 1.014673 1.007002
[51,] 1.002186 1.004522 1.002315

theoretical2 = true.ratios[,2]
theoretical13 = (true.ratios[,1] + true.ratios[,3])/2

theoretical.df = data.frame(
  ratios = c(theoretical13, theoretical2),
  clusters = c(rep("cluster 1 and 3", 51), rep("cluster 2", 51)),
  delta = c(test.seq, test.seq)
)

ggplot(theoretical.df, aes(x = delta, y = ratios, shape = clusters, 
                           color = clusters,
                           linetype = clusters)) +
  theme_grey(base_size = 20) + 
  geom_point(size = 0.7) + geom_line() + 
  ylab("theoretical variance ratio") +
scale_color_manual(values=c("#999999","#000000")) 
  
## delta = 2
[,1]     [,2]     [,3]     [,4]     [,5]
[1,] 1.567852 1.568024 1.567957 1.567551 1.567092
[2,] 3.425477 3.426129 3.425391 3.426622 3.425583
[3,] 1.567740 1.568836 1.568201 1.567817 1.566573

## delta = 3
[,1]     [,2]     [,3]     [,4]     [,5]
[1,] 1.358195 1.358497 1.358092 1.357696 1.358634
[2,] 2.118051 2.117360 2.118478 2.118125 2.117660
[3,] 1.358256 1.358632 1.358439 1.358829 1.358572